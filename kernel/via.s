.import   _stop
.export   _irq_int, _nmi_int

.import put_c
.import PORTA
.import lcd_instruction

.segment "DATA"

ps2c: .byte 0
ps2cp: .byte 0
data: .byte 0
datan: .byte 0

.segment  "CODE"

.PC02

_irq_int:
      	RTI

break:
      	JMP _stop

_nmi_int:
      	PHA
        PHX

        INC ps2c
        INC ps2cp
        LDA ps2c
        
        CMP #1
        BEQ end
        CMP #10
        BEQ end
        CMP #11
        BEQ reset

        LDA ps2cp
        CMP #11
        BCC main
        JMP end
main:
        LDA PORTA
        AND #%00000001
        STA datan

        LDA data
        ASL
        ORA datan
        STA data

end:
        LDA ps2cp
        CMP #33
        BEQ reset_c

      	PLA
        PLX
      	RTI

reset:
        LDA #0
        STA ps2c
        JMP end

reset_c:
        LDA #0
        STA ps2cp

        LDX data
        LDA keymap, X
        JSR put_c

        JMP end

.segment "RODATA"

keymap:
  .byte "???????????????"
  .byte "???????????????"
  .byte "????o?e?????[?g"
  .byte "?????;?t???a???"
  .byte "u?????k?x?????'"
  .byte "?b?????/?v???z?"
  .byte "??m?????9?3???1"
  .byte "???6???????5???"
  .byte "2???8?????,?c??"
  .byte "?????n?????.? ?"
  .byte "????????????0?4"
  .byte "???q???y?????p?"
  .byte "r???w???7?????i"
  .byte "?d???????h?????"
  .byte "l?f???s?]?j????"
  .byte "123456789ABCDEF"
